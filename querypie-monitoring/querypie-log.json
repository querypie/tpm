{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": 36,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 5,
      "panels": [],
      "title": "SQL 실행 현황",
      "type": "row"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "continuous-GrYlRd"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 5,
        "x": 0,
        "y": 1
      },
      "id": 1,
      "options": {
        "displayMode": "basic",
        "maxVizHeight": 300,
        "minVizHeight": 16,
        "minVizWidth": 8,
        "namePlacement": "auto",
        "orientation": "horizontal",
        "reduceOptions": {
          "calcs": [],
          "fields": "",
          "values": true
        },
        "showUnfilled": true,
        "sizing": "auto",
        "valueMode": "color"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n    COUNT(*),\n    CASE state\n        WHEN 1 THEN 'SUCCESS'\n        WHEN 2 THEN 'FAILURE' \n        WHEN 3 THEN 'STOPPED'\n        WHEN 5 THEN 'RUNNING'\n        WHEN 6 THEN 'ABORTED'\n        ELSE 'UNKNOWN'\n    END as state_name\nFROM querypie_log.l_query_execution_logs\nWHERE action_type = 1 and executed_at BETWEEN $__timeFrom() AND $__timeTo()\nGROUP BY \n    CASE state\n        WHEN 1 THEN 'SUCCESS'\n        WHEN 2 THEN 'FAILURE'\n        WHEN 3 THEN 'STOPPED'\n        WHEN 5 THEN 'RUNNING'\n        WHEN 6 THEN 'ABORTED'\n        ELSE 'UNKNOWN'\n    END;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "\bSQL 실행상태 통계",
      "type": "bargauge"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 10,
        "x": 5,
        "y": 1
      },
      "id": 3,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "right",
          "showLegend": true
        },
        "orientation": "horizontal",
        "showValue": "never",
        "stacking": "none",
        "tooltip": {
          "mode": "single",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 0
      },
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "select count(*) as 'Executed', concat(b.user_name, '(', b.user_email,')')\nfrom querypie_log.l_query_execution_logs a left join querypie_log.l_user_snapshots b on a.user_snapshot_id = b.id\nwhere a.action_type = 1 and a.executed_at BETWEEN $__timeFrom() AND $__timeTo()\ngroup by concat(b.user_name, '(', b.user_email,')') \norder by count(*) desc\nLIMIT 10",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "SQL 실행 계정 상위 10",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 9,
        "x": 15,
        "y": 1
      },
      "id": 4,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n    $__timeGroupAlias(executed_at,$__interval),\n    COUNT(*) as 'Total SQL',\n    SUM(CASE WHEN prevented = 1 THEN 1 ELSE 0 END) as 'Prevented',\n    SUM(processed_record_count) as 'Total Record'\nFROM querypie_log.l_query_execution_logs\nWHERE \n    $__timeFilter(executed_at)\n    AND action_type = 1\nGROUP BY 1\nORDER BY 1;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "SQL 실행 추이",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 9
      },
      "id": 8,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n    $__timeGroupAlias(executed_at,$__interval),\n    SUM(CASE WHEN action_type = 1 THEN 1 ELSE 0 END) as 'SQL Execution',\n    SUM(CASE WHEN action_type = 2 THEN 1 ELSE 0 END) as 'Export Data',\n    SUM(CASE WHEN action_type = 3 THEN 1 ELSE 0 END) as 'Export Schema',\n    SUM(CASE WHEN action_type = 4 THEN 1 ELSE 0 END) as 'Import Data',\n    SUM(CASE WHEN action_type = 5 THEN 1 ELSE 0 END) as 'Import Schema',    \n    SUM(CASE WHEN action_type = 6 THEN 1 ELSE 0 END) as 'Clipboard Copy'\n\nFROM querypie_log.l_query_execution_logs\nWHERE \n    $__timeFilter(executed_at)\n    AND action_type = 1\nGROUP BY 1\nORDER BY 1;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "이벤트별 추이",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 9
      },
      "id": 9,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n    $__timeGroupAlias(executed_at,$__interval),\n    SUM(CASE WHEN state = 1 THEN 1 ELSE 0 END) as 'Success',\n    SUM(CASE WHEN state = 2 THEN 1 ELSE 0 END) as 'Failure',\n    SUM(CASE WHEN state = 3 THEN 1 ELSE 0 END) as 'Stopped',\n    SUM(CASE WHEN state = 6 THEN 1 ELSE 0 END) as 'Abroted'\n\nFROM querypie_log.l_query_execution_logs\nWHERE \n    $__timeFilter(executed_at)\n    AND action_type = 1\nGROUP BY 1\nORDER BY 1;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "SQL 상태별 추이",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 17
      },
      "id": 10,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  a.id as '#', \n  a.executed_at as '실행시간', \n  a.client_ip as 'IP',\n  concat(b.user_name, '(', b.user_email,')') as '사용자',\n  IFNULL(c.cloud_provider_type, 'On-Premise') as 'Infra',\n  c.cluster_group_name as 'DB명',\n  a.db_user as 'DB User',\n  c.db_host as 'DB Host',\n  c.cluster_repl_type as 'Master/Slave',\n  c.db_type as 'DB 타입',\n  a.query_text as 'SQL',\n  a.query_target_object_names as 'Target Object'\nFROM querypie_log.l_query_running_logs a \nLEFT JOIN querypie_log.l_user_snapshots b ON a.user_snapshot_id = b.id  \nLEFT JOIN l_db_connection_snapshots c ON a.db_connection_snapshot_id = c.id\nwhere a.executed_at BETWEEN $__timeFrom() AND $__timeTo()\n",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "실시간 쿼리 현황",
      "type": "table"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "filterable": true,
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 14,
        "w": 24,
        "x": 0,
        "y": 25
      },
      "id": 7,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "enablePagination": true,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "\nSELECT \n  a.id as '#', \n  a.executed_at as '실행시간', \n  a.client_ip as 'IP',\n  concat(b.user_name, '(', b.user_email,')') as '사용자',\n  CASE a.state\n        WHEN 1 THEN '성공'\n        WHEN 2 THEN '실패' \n        WHEN 3 THEN '중단'\n        WHEN 5 THEN '실행중'\n        WHEN 6 THEN '취소'\n        ELSE 'UNKNOWN'\n  END as '상태',\n  IFNULL(c.cloud_provider_type, 'On-Premise') as 'Infra',\n  c.cluster_group_name as 'DB명',\n  a.db_user as 'DB User',\n  c.db_host as 'DB Host',\n  c.cluster_repl_type as 'Master/Slave',\n  c.db_type as 'DB 타입',\n  a.query_text as 'SQL',\n  a.processing_millis as '처리시간(ms)',\n  a.processed_record_count as '처리개수'\nFROM querypie_log.l_query_execution_logs a \nLEFT JOIN querypie_log.l_user_snapshots b ON a.user_snapshot_id = b.id  \nLEFT JOIN l_db_connection_snapshots c ON a.db_connection_snapshot_id = c.id\nwhere a.executed_at BETWEEN $__timeFrom() AND $__timeTo()\norder by a.executed_at desc",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "최근 SQL 실행 내역",
      "type": "table"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 39
      },
      "id": 6,
      "panels": [],
      "title": "데이터 변경 현황",
      "type": "row"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 40
      },
      "id": 14,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "right",
          "showLegend": true
        },
        "orientation": "horizontal",
        "showValue": "never",
        "stacking": "none",
        "tooltip": {
          "mode": "single",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 0
      },
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "select count(*) as 'Executed', concat(b.user_name, '(', b.user_email,')')\nfrom querypie_log.l_query_execution_logs a left join querypie_log.l_user_snapshots b on a.user_snapshot_id = b.id\nwhere a.action_type = 1 and a.query_type in (3,4,5,6,7,8,10,11,12,13) and a.executed_at BETWEEN $__timeFrom() AND $__timeTo()\ngroup by concat(b.user_name, '(', b.user_email,')') \norder by count(*) desc\nLIMIT 10",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "데이터 변경 계정 상위 10",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 40
      },
      "id": 15,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "right",
          "showLegend": true
        },
        "orientation": "horizontal",
        "showValue": "never",
        "stacking": "none",
        "tooltip": {
          "mode": "single",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 0
      },
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "select count(*) as 'Executed', a.client_ip\nfrom querypie_log.l_query_execution_logs a left join querypie_log.l_user_snapshots b on a.user_snapshot_id = b.id\nwhere a.action_type = 1 and a.query_type in (3,4,5,6,7,8,10,11,12,13) and a.executed_at BETWEEN $__timeFrom() AND $__timeTo()\ngroup by a.client_ip\norder by count(*) desc\nLIMIT 10",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "데이터 변경 IP 상위 10",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 48
      },
      "id": 12,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n    $__timeGroupAlias(executed_at,$__interval),\n    SUM(IF(query_type = 3, 1, 0)) as 'Insert',\n    SUM(IF(query_type = 6, 1, 0)) as 'Update',\n    SUM(IF(query_type = 7, 1, 0)) as 'Delete'\nFROM querypie_log.l_query_execution_logs\nWHERE \n    $__timeFilter(executed_at)\n    AND hidden = 0\n    AND query_type IN (2,3,6,7)\nGROUP BY 1\nORDER BY 1;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "DML 실행 추이",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 48
      },
      "id": 13,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n    $__timeGroupAlias(executed_at,$__interval),\n    SUM(IF(query_type = 9, 1, 0)) as 'Create',\n    SUM(IF(query_type = 10, 1, 0)) as 'Alter',\n    SUM(IF(query_type = 11, 1, 0)) as 'Drop'\nFROM querypie_log.l_query_execution_logs\nWHERE \n    $__timeFilter(executed_at)\n    AND hidden = 0\n    AND query_type IN (9,10,11)\nGROUP BY 1\nORDER BY 1;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "DDL 실행 추이",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "filterable": true,
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 10,
        "w": 24,
        "x": 0,
        "y": 56
      },
      "id": 11,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "enablePagination": true,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  a.id as '#', \n  a.executed_at as '실행시간', \n  a.client_ip as 'IP',\n  concat(b.user_name, '(', b.user_email,')') as '사용자',\n  CASE a.state\n        WHEN 1 THEN '성공'\n        WHEN 2 THEN '실패' \n        WHEN 3 THEN '중단'\n        WHEN 5 THEN '실행중'\n        WHEN 6 THEN '취소'\n        ELSE 'UNKNOWN'\n  END as '상태',\n  IFNULL(c.cloud_provider_type, 'On-Premise') as 'Infra',\n  c.cluster_group_name as 'DB명',\n  a.db_user as 'DB User',\n  c.db_host as 'DB Host',\n  c.cluster_repl_type as 'Master/Slave',\n  c.db_type as 'DB 타입',\n   CASE a.query_type\n        WHEN 0 THEN 'Unknown'\n        WHEN 1 THEN 'With'\n        WHEN 2 THEN 'Select'\n        WHEN 3 THEN 'Insert'\n        WHEN 4 THEN 'Upsert'\n        WHEN 5 THEN 'Replace'\n        WHEN 6 THEN 'Update'\n        WHEN 7 THEN 'Delete'\n        WHEN 8 THEN 'Merge Into'\n        WHEN 9 THEN 'Create'\n        WHEN 10 THEN 'Alter'\n        WHEN 11 THEN 'Drop'\n        WHEN 12 THEN 'Rename'\n        WHEN 13 THEN 'Truncate'\n        WHEN 14 THEN 'Grant'\n        WHEN 15 THEN 'Revoke'\n        WHEN 16 THEN 'Commit'\n        WHEN 17 THEN 'Rollback'\n        WHEN 18 THEN 'Save Point'\n        WHEN 19 THEN 'Prepare'\n        WHEN 20 THEN 'Drop Prepare'\n        WHEN 21 THEN 'Execute'\n        WHEN 22 THEN 'Delimiter'\n        WHEN 23 THEN 'Call'\n        WHEN 24 THEN 'Explain'\n        WHEN 25 THEN 'Use'\n        WHEN 26 THEN 'Show'\n        WHEN 27 THEN 'Describe'\n        WHEN 28 THEN 'Set'\n        WHEN 29 THEN 'Begin'\n        WHEN 30 THEN 'Comment'\n        WHEN 31 THEN 'Trivia'\n        ELSE 'Unknown'\n    END as 'Query Type',\n    a.query_text as 'SQL',\n  a.processing_millis as '처리시간(ms)',\n  a.processed_record_count as '변경된 데이터(건)'\nFROM querypie_log.l_query_execution_logs a \nLEFT JOIN querypie_log.l_user_snapshots b ON a.user_snapshot_id = b.id  \nLEFT JOIN l_db_connection_snapshots c ON a.db_connection_snapshot_id = c.id\nWHERE\n    a.query_type in (3,4,5,6,7,8,10,11,12,13) and a.executed_at BETWEEN $__timeFrom() AND $__timeTo()\norder by a.executed_at desc",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "최근 데이터 변경 내역",
      "type": "table"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 66
      },
      "id": 16,
      "panels": [],
      "title": "인증 현황",
      "type": "row"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 67
      },
      "id": 19,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "right",
          "showLegend": true
        },
        "orientation": "horizontal",
        "showValue": "never",
        "stacking": "none",
        "tooltip": {
          "mode": "single",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 0
      },
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "select count(*) as' Count', concat(user_name,'(',user_email,')') as '사용자' from querypie_log.l_user_auth_logs\nwhere error = 1 and user_name is not null and acted_at BETWEEN $__timeFrom() AND $__timeTo()\ngroup by 2\norder by count(*) desc\nLIMIT 10",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "인증 실패 계정 상위 10",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 67
      },
      "id": 20,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "right",
          "showLegend": true
        },
        "orientation": "horizontal",
        "showValue": "never",
        "stacking": "none",
        "tooltip": {
          "mode": "single",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 0
      },
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "select count(*) as' Count', client_ip as 'IP' from querypie_log.l_user_auth_logs\nwhere error = 1 and user_name is not null and acted_at BETWEEN $__timeFrom() AND $__timeTo()\ngroup by 2\norder by count(*) desc\nLIMIT 10",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "인증 실패 IP 상위 10",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 10,
        "w": 24,
        "x": 0,
        "y": 75
      },
      "id": 21,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n    $__timeGroupAlias(acted_at,$__interval),\n    COUNT(*) as 'Total Count',\n    SUM(CASE WHEN action_type = 'LOGIN' THEN 1 ELSE 0 END) as 'Login',\n    SUM(CASE WHEN action_type = 'LOGOUT' THEN 1 ELSE 0 END) as 'Logout',\n    SUM(CASE WHEN action_type = 'EXPIRED' THEN 1 ELSE 0 END) as 'Expired'\nFROM querypie_log.l_user_auth_logs\nWHERE \n    $__timeFilter(acted_at)\nGROUP BY 1\nORDER BY 1;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "인증 추이",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 13,
        "w": 24,
        "x": 0,
        "y": 85
      },
      "id": 22,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "enablePagination": true,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "select \n  id as '#',\n  acted_at as '시간',\n  user_name as '사용자',\n  user_email as 'Email',\n  client_ip as 'IP',\n  case when error = 1 THEN '실패' ELSE '성공' END as '결과',\n  action_type as '행위'\n \nfrom querypie_log.l_user_auth_logs\nwhere acted_at BETWEEN $__timeFrom() AND $__timeTo()\norder by id desc",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "최근 인증 내역",
      "type": "table"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 98
      },
      "id": 17,
      "panels": [],
      "title": "권한 변경 현황",
      "type": "row"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            }
          },
          "mappings": []
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 3,
        "x": 0,
        "y": 99
      },
      "id": 23,
      "options": {
        "displayLabels": [
          "value",
          "name",
          "percent"
        ],
        "legend": {
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "pieType": "pie",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "select mod_type as 'ACL', count(*) as 'Count' from l_connection_user_role_logs\nwhere action_at BETWEEN $__timeFrom() AND $__timeTo()\ngroup by mod_type;\n",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "권한 변경 유형",
      "type": "piechart"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            }
          },
          "mappings": []
        },
        "overrides": [
          {
            "__systemRef": "hideSeriesFrom",
            "matcher": {
              "id": "byNames",
              "options": {
                "mode": "exclude",
                "names": [
                  "Count",
                  "BigQuery"
                ],
                "prefix": "All except:",
                "readOnly": true
              }
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": false,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 4,
        "x": 3,
        "y": 99
      },
      "id": 24,
      "options": {
        "displayLabels": [
          "value",
          "name"
        ],
        "legend": {
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "pieType": "pie",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "select count(*) as 'Count', db_type from l_connection_user_role_logs\nwhere action_at BETWEEN $__timeFrom() AND $__timeTo()\ngroup by db_type;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "권한 변경 DB 유형",
      "type": "piechart"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 7,
        "x": 7,
        "y": 99
      },
      "id": 26,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "right",
          "showLegend": true
        },
        "orientation": "horizontal",
        "showValue": "never",
        "stacking": "none",
        "tooltip": {
          "mode": "single",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 0
      },
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "select count(*) as 'Count', concat(user_name, '(',user_email, ')')  from l_connection_user_role_logs\nwhere action_at BETWEEN $__timeFrom() AND $__timeTo()\ngroup by 2\norder by count(*) desc\nLIMIT 10;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "권한 부여 대상 상위 10",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 10,
        "x": 14,
        "y": 99
      },
      "id": 25,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "SELECT \n    $__timeGroupAlias(action_at,$__interval),\n    COUNT(*) as 'Total',\n    SUM(CASE WHEN mod_type = 'ACL_ADD' THEN 1 ELSE 0 END) as 'Granted',\n    SUM(CASE WHEN mod_type = 'ACL_MOD' THEN 1 ELSE 0 END) as 'Changed',\n    SUM(CASE WHEN mod_type = 'ACL_REMOVE' THEN 1 ELSE 0 END) as 'Revoked'\nFROM l_connection_user_role_logs\nWHERE \n    $__timeFilter(action_at)    \nGROUP BY 1\nORDER BY 1;\n",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "권한 변경 추이",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "filterable": true,
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 13,
        "w": 24,
        "x": 0,
        "y": 107
      },
      "id": 27,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "enablePagination": true,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  action_at as '시간',\n  mod_type as '유형',\n  IF(user_email != '' AND user_email IS NOT NULL, \n     concat(user_name, '(', user_email, ')'),\n     user_name) as '계정',\n  user_type as '사용자/그룹',\n  db_type as 'DB 유형',\n  db_host as 'DB 호스트',\n  role_name as '역할이름',\n  privilege_types as '역할권한목록'\nFROM querypie_log.l_connection_user_role_logs\nwhere action_at BETWEEN $__timeFrom() AND $__timeTo()\n",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "최근 권한 변경 내역",
      "type": "table"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 120
      },
      "id": 18,
      "panels": [],
      "title": "결재 현황",
      "type": "row"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 7,
        "x": 0,
        "y": 121
      },
      "id": 28,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "right",
          "showLegend": true
        },
        "orientation": "horizontal",
        "showValue": "never",
        "stacking": "none",
        "tooltip": {
          "mode": "single",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 0
      },
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "select count(*) as 'Count', concat(requester_name, '(',requester_email, ')') as '사용자' from querypie.workflow_requests\nwhere requested_at BETWEEN $__timeFrom() AND $__timeTo()\ngroup by 2\norder by count(*) desc\nLIMIT 10;\n",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "결재 요청 계정 상위 10",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 7,
        "x": 7,
        "y": 121
      },
      "id": 30,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "right",
          "showLegend": true
        },
        "orientation": "horizontal",
        "showValue": "never",
        "stacking": "none",
        "tooltip": {
          "mode": "single",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 0
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "select \n    count(*) as 'Count',\n    e.name as 'Name'\nfrom querypie.workflow_requests a\nleft join querypie.workflow_request_detail_access_controls b on a.uuid = b.workflow_request_uuid\nleft join querypie.clusters c on b.object_uuid = c.uuid\nleft join querypie.cluster_groups e on c.group_id = e.id\nwhere \n    a.request_type = 'DB_ACCESS_CONTROL' and a.requested_at BETWEEN $__timeFrom() AND $__timeTo()\ngroup by 2\norder by count(*) desc\nLIMIT 10\n",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "결재 대상 DB 상위 10",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 10,
        "x": 14,
        "y": 121
      },
      "id": 31,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "\n\nSELECT \n    $__timeGroupAlias(requested_at,$__interval),\n    COUNT(*) as 'Total',\n    SUM(CASE WHEN request_type = 'DATA_EXPORT' THEN 1 ELSE 0 END) as 'Export 요청',\n    SUM(CASE WHEN request_type = 'SQL_EXECUTION' THEN 1 ELSE 0 END) as 'SQL 실행 요청',\n    SUM(CASE WHEN request_type = 'DB_ACCESS_CONTROL' THEN 1 ELSE 0 END) as 'DB 권한 요청',\n    SUM(CASE WHEN request_type = 'SERVER_ACCESS_CONTROL' THEN 1 ELSE 0 END) as '서버 권한 요청',\n    SUM(CASE WHEN request_type = 'UNMASKING' THEN 1 ELSE 0 END) as '마스킹 해제 요청',\n    SUM(CASE WHEN request_type = 'ACCESS_ROLE' THEN 1 ELSE 0 END) as 'K8S 권한 요청'\n\nFROM querypie.workflow_requests\nWHERE \n    $__timeFilter(requested_at)    \nGROUP BY 1\nORDER BY 1;\n",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "결재 추이",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "filterable": true,
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 12,
        "w": 24,
        "x": 0,
        "y": 129
      },
      "id": 29,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "enablePagination": true,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "select \n    a.requested_at as '시간',\n    a.approval_status as '승인상태',\n    a.execution_status as '상태',\n    a.title as '요청내용',\n    CASE \n        WHEN a.request_type = 'DATA_EXPORT' THEN '데이터 추출 요청'\n        WHEN a.request_type = 'SQL_EXECUTION' THEN 'SQL 실행 요청'\n        WHEN a.request_type = 'DB_ACCESS_CONTROL' THEN 'DB 권한 요청'\n        WHEN a.request_type = 'SERVER_ACCESS_CONTROL' THEN '서버 권한 요청'\n        WHEN a.request_type = 'UNMASKING' THEN '마스킹 해제 요청'\n        WHEN a.request_type = 'ACCESS_ROLE' THEN 'K8S 권한 요청'\n    END as '유형',\nc.host, d.name, d.privilege_types  from querypie.workflow_requests a\nleft join querypie.workflow_request_detail_access_controls b on a.uuid = b.workflow_request_uuid\nleft join querypie.clusters c on b.object_uuid = c.uuid\nleft join querypie.cluster_roles d on b.role_uuid = d.uuid\nwhere \n    a.request_type = 'DB_ACCESS_CONTROL' and a.requested_at BETWEEN $__timeFrom() AND $__timeTo()\norder by a.requested_at desc\n",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "최근 결재 요청 내역",
      "type": "table"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "querypie"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": [
          {
            "__systemRef": "hideSeriesFrom",
            "matcher": {
              "id": "byNames",
              "options": {
                "mode": "exclude",
                "names": [
                  "count(*)"
                ],
                "prefix": "All except:",
                "readOnly": true
              }
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": false,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 7,
        "x": 0,
        "y": 141
      },
      "id": 2,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "right",
          "showLegend": true
        },
        "orientation": "horizontal",
        "showValue": "never",
        "stacking": "none",
        "tooltip": {
          "mode": "single",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 0
      },
      "targets": [
        {
          "dataset": "mysql",
          "datasource": {
            "type": "mysql",
            "uid": "querypie"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "select count(*) as 'Count', action_type from querypie_log.l_activity_logs\nwhere action_type in ('CLUSTER_CREATED2', '2CONNECTION_CREATED', '2INSTANCE_CREATED') and action_at BETWEEN $__timeFrom() AND $__timeTo()\ngroup by action_type;\n\n\n\n",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "신규 추가된 데이터베이스 개수",
      "type": "barchart"
    }
  ],
  "refresh": "5s",
  "schemaVersion": 39,
  "tags": [],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now/y",
    "to": "now/y"
  },
  "timepicker": {},
  "timezone": "browser",
  "title": "QueryPie Log Dashboard",
  "uid": "ce43307dvqo74c",
  "version": 29,
  "weekStart": ""
}